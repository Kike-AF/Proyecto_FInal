{% extends "base.html" %}
{% block title %}Lista de Pacientes{% endblock %}
{% block content %} <!-- Contenido de la página --> 

<div class="d-flex justify-content-end align-items-center">  
    {% if session.get('usuario') %}
    <!-- Si el usuario a iniciado sesión, mostrar su nombre -->
    <span class="me-3">Bienvenido, {{ session['usuario'] }}</span>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary btn-sm">Cerrar Sesión</a>
    {% endif %}
</div>

<div class="d-flex justify-content-start align-items-center">
    <!-- Enlace a la vista de nuevo paciente -->
    <a href="{{url_for('nuevo_paciente')}}" class="btn btn-outline-primary btn-sm m-3">Nuevo Paciente</a>
    <!-- Enlace para exportar datos en formato csv -->
    <a href="{{ url_for('exportar_csv') }}" class="btn btn-outline-success btn-sm m-3">Exportar CSV</a>
    <!-- Enlace para exportar datos en formato xlsx -->
     <a href="{{ url_for('exportar_excel') }}" class="btn btn-outline-info btn-sm m-3">Exportar Excel</a>
</div>

<!-- Formulario para realizar la busqueda con filtro -->
<form action="{{ url_for('index') }}" method="get" class="mb-3 d-flex">

    <!-- Campo de entrada de texto para el filtro de busqueda -->
     <input type="text" name="filtro" class="form-control me-2" placeholder="Buscar por nombre o diagnóstico" 
        value="{{ request.args.get('filtro', '') }}">
    <!-- Botón de búsqueda -->
        <button type="submit" class="btn btn-primary">Buscar</button>
</form>

<!-- Tabla lista de pacientes-->
<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th> 
            <th>Nombre</th>
            <th>Edad</th>
            <th>Diagnóstico</th>
            <th>Acción</th>
        </tr>
    </thead>
        <tbody>
            <!-- {# Iterar sobre la lista de pacientes y mostrar sus datos en la tabla #} -->
            {% for paciente in pacientes %}
                <tr>
                    <td>{{ paciente[0] }}</td>
                    <td>{{ paciente[1] }}</td>
                    <td>{{ paciente[2] }}</td>
                    <td>{{ paciente[3] }}</td>
                    <td>
                        <!-- Enlace para eliminar el paciente -->
                        <a href="{{ url_for('editar_paciente', id=paciente[0]) }}" class="m-3">Editar</a>&nbsp;|&nbsp;
                        <form action="{{ url_for('eliminar_paciente', id=paciente[0]) }}" method="post" style="display:inline;"
                            onsubmit="return confirm('¿Estás seguro de que deseas eliminar este paciente?');">

                            <button type="submit" class="btn btn-link">Eliminar</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}

        </tbody>
</table>
    <!-- Aqui termina el bloque de contenido de la página-->
{% endblock %}
</body>
</html>